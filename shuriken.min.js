var shuriken;!function(a){var b=function(){function b(a,b){var c=this;this._buttonDownState={},this._buttonPressedState={},b.addEventListener("keydown",function(a){c._down(a.keyCode)},!1),b.addEventListener("keyup",function(a){c._up(a.keyCode)},!1),a.addEventListener("mousedown",function(a){c._down(c._getMouseButton(a))},!1),a.addEventListener("mouseup",function(a){c._up(c._getMouseButton(a))},!1)}return b.prototype.update=function(){for(var a in this._buttonPressedState)this._buttonPressedState[a]===!0&&(this._buttonPressedState[a]=!1)},b.prototype._down=function(a){this._buttonDownState[a]=!0,void 0===this._buttonPressedState[a]&&(this._buttonPressedState[a]=!0)},b.prototype._up=function(a){this._buttonDownState[a]=!1,this._buttonPressedState[a]===!1&&(this._buttonPressedState[a]=void 0)},b.prototype.isDown=function(a){return this._buttonDownState[a]||!1},b.prototype.isPressed=function(a){return this._buttonPressedState[a]||!1},b.prototype._getMouseButton=function(b){if(void 0!==b.which||void 0!==b.button){if(3===b.which||2===b.button)return a.MouseClick.RIGHT_MOUSE;if(1===b.which||0===b.button||1===b.button)return a.MouseClick.LEFT_MOUSE}throw"Cannot judge button pressed on passed mouse button event"},b}();a.ButtonListener=b}(shuriken||(shuriken={}));var shuriken;!function(a){var b=function(){function b(a){this._currentCollisionPairs=[],this._shuriken=a}return b.prototype.isSetupForCollisions=function(a){return void 0!==a.center&&void 0!==a.size},b.prototype.update=function(){this._currentCollisionPairs=[];for(var a=this._shuriken.entities.all(),b=0;b<a.length;b++)for(var c=b+1;c<a.length;c++)this._currentCollisionPairs.push([a[b],a[c]]);for(;this._currentCollisionPairs.length>0;){var d=this._currentCollisionPairs.shift();this.isColliding(d[0],d[1])&&this.collision(d[0],d[1])}},b.prototype.collision=function(a,b){this.notifyEntityOfCollision(a,b),this.notifyEntityOfCollision(b,a)},b.prototype.createEntity=function(a){for(var b=this._shuriken.entities.all(),c=0,d=b.length;c<d;c++)b[c]!==a&&this._currentCollisionPairs.push([b[c],a])},b.prototype.destroyEntity=function(a){for(var b=this._currentCollisionPairs.length-1;b>=0;b--)this._currentCollisionPairs[b][0]!==a&&this._currentCollisionPairs[b][1]!==a||this._currentCollisionPairs.splice(b,1)},b.prototype.isColliding=function(a,b){return a!==b&&this.isSetupForCollisions(a)&&this.isSetupForCollisions(b)&&this.isIntersecting(a,b)},b.prototype.isIntersecting=function(c,d){var e=this.getBoundingBox(c),f=this.getBoundingBox(d);if(e===b.RECTANGLE&&f===b.RECTANGLE)return a.Maths.rectanglesIntersecting(c,d);if(e===b.CIRCLE&&f===b.RECTANGLE)return a.Maths.circleAndRectangleIntersecting(c,d);if(e===b.RECTANGLE&&f===b.CIRCLE)return a.Maths.circleAndRectangleIntersecting(d,c);if(e===b.CIRCLE&&f===b.CIRCLE)return a.Maths.circlesIntersecting(c,d);throw"Objects being collision tested have unsupported bounding box types."},b.prototype.getBoundingBox=function(a){return a.boundingBox||b.RECTANGLE},b.prototype.notifyEntityOfCollision=function(a,b){void 0!==a.collision&&a.collision(b)},b}();b.RECTANGLE=0,b.CIRCLE=1,a.Collider=b}(shuriken||(shuriken={}));var shuriken;!function(a){var b=function(){function a(a,b){this._entities=[],this._shuriken=a,this._game=b}return a.prototype.update=function(a){for(var b=this.all(),c=0,d=b.length;c<d;c++)void 0!==b[c].update&&b[c].update(a)},a.prototype.all=function(a){if(void 0===a)return this._entities.slice();for(var b=[],c=0;c<this._entities.length;c++)this._entities[c]instanceof a&&b.push(this._entities[c]);return b},a.prototype.create=function(a,b){var c=new a(this._game,b||{});return this._shuriken.collider.createEntity(c),this._entities.push(c),c},a.prototype.destroy=function(a){for(var b=0;b<this._entities.length;b++)if(this._entities[b]===a){this._shuriken.collider.destroyEntity(a),this._entities.splice(b,1);break}},a}();a.Entities=b}(shuriken||(shuriken={}));var shuriken;!function(a){var b=function(){function b(b,c,d){var e=d===!1?c:window;this.connectReceiverToKeyboard(e,window,d),this._buttonListener=new a.ButtonListener(c,e),this._mouseMoveListener=new a.MouseMoveListener(c)}return b.prototype.update=function(){this._buttonListener.update()},b.prototype.isDown=function(a){return this._buttonListener.isDown(a)},b.prototype.isPressed=function(a){return this._buttonListener.isPressed(a)},b.prototype.getMousePosition=function(){return this._mouseMoveListener.getMousePosition()},b.prototype.bindMouseMove=function(a){return this._mouseMoveListener.bind(a)},b.prototype.unbindMouseMove=function(a){return this._mouseMoveListener.unbind(a)},b.prototype.connectReceiverToKeyboard=function(b,c,d){if(d===!1)b.contentEditable=!0;else{var e=[a.KeyboardButton.SPACE,a.KeyboardButton.LEFT_ARROW,a.KeyboardButton.UP_ARROW,a.KeyboardButton.RIGHT_ARROW,a.KeyboardButton.DOWN_ARROW];c.addEventListener("keydown",function(a){for(var b=0;b<e.length;b++)if(e[b]===a.keyCode)return void a.preventDefault()},!1)}},b}();a.Inputter=b}(shuriken||(shuriken={}));var shuriken;!function(a){var b;!function(a){a[a.LEFT_MOUSE=0]="LEFT_MOUSE",a[a.RIGHT_MOUSE=1]="RIGHT_MOUSE"}(b=a.MouseClick||(a.MouseClick={}));var c;!function(a){a[a.BACKSPACE=8]="BACKSPACE",a[a.TAB=9]="TAB",a[a.ENTER=13]="ENTER",a[a.SHIFT=16]="SHIFT",a[a.CTRL=17]="CTRL",a[a.ALT=18]="ALT",a[a.PAUSE=19]="PAUSE",a[a.CAPS_LOCK=20]="CAPS_LOCK",a[a.ESC=27]="ESC",a[a.SPACE=32]="SPACE",a[a.PAGE_UP=33]="PAGE_UP",a[a.PAGE_DOWN=34]="PAGE_DOWN",a[a.END=35]="END",a[a.HOME=36]="HOME",a[a.LEFT_ARROW=37]="LEFT_ARROW",a[a.UP_ARROW=38]="UP_ARROW",a[a.RIGHT_ARROW=39]="RIGHT_ARROW",a[a.DOWN_ARROW=40]="DOWN_ARROW",a[a.INSERT=45]="INSERT",a[a.DELETE=46]="DELETE",a[a.ZERO=48]="ZERO",a[a.ONE=49]="ONE",a[a.TWO=50]="TWO",a[a.THREE=51]="THREE",a[a.FOUR=52]="FOUR",a[a.FIVE=53]="FIVE",a[a.SIX=54]="SIX",a[a.SEVEN=55]="SEVEN",a[a.EIGHT=56]="EIGHT",a[a.NINE=57]="NINE",a[a.A=65]="A",a[a.B=66]="B",a[a.C=67]="C",a[a.D=68]="D",a[a.E=69]="E",a[a.F=70]="F",a[a.G=71]="G",a[a.H=72]="H",a[a.I=73]="I",a[a.J=74]="J",a[a.K=75]="K",a[a.L=76]="L",a[a.M=77]="M",a[a.N=78]="N",a[a.O=79]="O",a[a.P=80]="P",a[a.Q=81]="Q",a[a.R=82]="R",a[a.S=83]="S",a[a.T=84]="T",a[a.U=85]="U",a[a.V=86]="V",a[a.W=87]="W",a[a.X=88]="X",a[a.Y=89]="Y",a[a.Z=90]="Z",a[a.F1=112]="F1",a[a.F2=113]="F2",a[a.F3=114]="F3",a[a.F4=115]="F4",a[a.F5=116]="F5",a[a.F6=117]="F6",a[a.F7=118]="F7",a[a.F8=119]="F8",a[a.F9=120]="F9",a[a.F10=121]="F10",a[a.F11=122]="F11",a[a.F12=123]="F12",a[a.NUM_LOCK=144]="NUM_LOCK",a[a.SCROLL_LOCK=145]="SCROLL_LOCK",a[a.SEMI_COLON=186]="SEMI_COLON",a[a.EQUALS=187]="EQUALS",a[a.COMMA=188]="COMMA",a[a.DASH=189]="DASH",a[a.PERIOD=190]="PERIOD",a[a.FORWARD_SLASH=191]="FORWARD_SLASH",a[a.GRAVE_ACCENT=192]="GRAVE_ACCENT",a[a.OPEN_SQUARE_BRACKET=219]="OPEN_SQUARE_BRACKET",a[a.BACK_SLASH=220]="BACK_SLASH",a[a.CLOSE_SQUARE_BRACKET=221]="CLOSE_SQUARE_BRACKET",a[a.SINGLE_QUOTE=222]="SINGLE_QUOTE"}(c=a.KeyboardButton||(a.KeyboardButton={}))}(shuriken||(shuriken={}));var shuriken;!function(a){var b=function(){function b(b,c,d,e,f,g){var h=this,i=document.getElementById(c);this._renderer=new a.Renderer(this,b,i,d,e,f),this._inputter=new a.Inputter(this,i,g),this._entities=new a.Entities(this,b),this._runner=new a.Runner(this),this._collider=new a.Collider(this),this._ticker=new a.Ticker(this,function(a){h._runner.update(),void 0!==b.update&&b.update(a),h._entities.update(a),h._collider.update(),h._renderer.update(a),h._inputter.update()})}return Object.defineProperty(b.prototype,"entities",{get:function(){return this._entities},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"collider",{get:function(){return this._collider},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"inputter",{get:function(){return this._inputter},enumerable:!0,configurable:!0}),b}();a.Shuriken=b}(shuriken||(shuriken={}));var shuriken;!function(a){var b=function(){function b(){}return b.circlesIntersecting=function(a,c){return b.distance(a.center,c.center)<a.size.x/2+c.size.x/2},b.rectanglesIntersecting=function(a,c){return b.rotated(a)||b.rotated(c)?this.rotatedRectanglesIntersecting(a,c):this.unrotatedRectanglesIntersecting(a,c)},b.circleAndRectangleIntersecting=function(a,c){var d=-b.getAngle(c)*b.RADIANS_TO_DEGREES,e={x:Math.cos(d)*(a.center.x-c.center.x)-Math.sin(d)*(a.center.y-c.center.y)+c.center.x,y:Math.sin(d)*(a.center.x-c.center.x)+Math.cos(d)*(a.center.y-c.center.y)+c.center.y},f={x:0,y:0};return e.x<c.center.x-c.size.x/2?f.x=c.center.x-c.size.x/2:e.x>c.center.x+c.size.x/2?f.x=c.center.x+c.size.x/2:f.x=e.x,e.y<c.center.y-c.size.y/2?f.y=c.center.y-c.size.y/2:e.y>c.center.y+c.size.y/2?f.y=c.center.y+c.size.y/2:f.y=e.y,this.distance(e,f)<a.size.x/2},b.unrotatedRectanglesIntersecting=function(a,b){return!(a.center.x+a.size.x/2<b.center.x-b.size.x/2)&&(!(a.center.x-a.size.x/2>b.center.x+b.size.x/2)&&(!(a.center.y-a.size.y/2>b.center.y+b.size.y/2)&&!(a.center.y+a.size.y/2<b.center.y-b.size.y/2)))},b.rotatedRectanglesIntersecting=function(a,b){var c=this.rectanglePerpendicularNormals(a),d=this.rectanglePerpendicularNormals(b),e=this.rectangleCorners(a),f=this.rectangleCorners(b);return!this.projectionsSeparate(this.getMinMaxProjection(e,c[1]),this.getMinMaxProjection(f,c[1]))&&(!this.projectionsSeparate(this.getMinMaxProjection(e,c[0]),this.getMinMaxProjection(f,c[0]))&&(!this.projectionsSeparate(this.getMinMaxProjection(e,d[1]),this.getMinMaxProjection(f,d[1]))&&!this.projectionsSeparate(this.getMinMaxProjection(e,d[0]),this.getMinMaxProjection(f,d[0]))))},b.pointInsideObj=function(c,d){var e=b.getBoundingBox(d);if(e===a.Collider.RECTANGLE)return this.pointInsideRectangle(c,d);if(e===a.Collider.CIRCLE)return this.pointInsideCircle(c,d);throw"Tried to see if point inside object with unsupported bounding box."},b.pointInsideRectangle=function(a,c){var d=Math.cos(-b.getAngle(c)*b.RADIANS_TO_DEGREES),e=Math.sin(-b.getAngle(c)*b.RADIANS_TO_DEGREES),f=c.center.x+d*(a.x-c.center.x)-e*(a.y-c.center.y),g=c.center.y+e*(a.x-c.center.x)+d*(a.y-c.center.y),h=c.center.x-c.size.x/2,i=c.center.x+c.size.x/2,j=c.center.y-c.size.y/2,k=c.center.y+c.size.y/2;return h<=f&&f<=i&&j<=g&&g<=k},b.pointInsideCircle=function(a,b){return this.distance(a,b.center)<=b.size.x/2},b.distance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)},b.vectorTo=function(a,b){return{x:b.x-a.x,y:b.y-a.y}},b.magnitude=function(a){return Math.sqrt(a.x*a.x+a.y*a.y)},b.leftNormalizedNormal=function(a){return{x:-a.y,y:a.x}},b.dotProduct=function(a,b){return a.x*b.x+a.y*b.y},b.unitVector=function(a){return{x:a.x/b.magnitude(a),y:a.y/b.magnitude(a)}},b.projectionsSeparate=function(a,b){return a.max<b.min||b.max<a.min},b.getMinMaxProjection=function(a,c){for(var d=b.dotProduct(a[0],c),e=b.dotProduct(a[0],c),f=1;f<a.length;f++){var g=b.dotProduct(a[f],c);d>g&&(d=g),g>e&&(e=g)}return{min:d,max:e}},b.rectangleCorners=function(a){for(var c=[{x:a.center.x-a.size.x/2,y:a.center.y-a.size.y/2},{x:a.center.x+a.size.x/2,y:a.center.y-a.size.y/2},{x:a.center.x+a.size.x/2,y:a.center.y+a.size.y/2},{x:a.center.x-a.size.x/2,y:a.center.y+a.size.y/2}],d=b.getAngle(a)*b.RADIANS_TO_DEGREES,e=0;e<c.length;e++){var f=c[e].x-a.center.x,g=c[e].y-a.center.y;c[e].x=a.center.x+f*Math.cos(d)-g*Math.sin(d),c[e].y=a.center.y+f*Math.sin(d)+g*Math.cos(d)}return c},b.rectangleSideVectors=function(a){var b=this.rectangleCorners(a);return[{x:b[0].x-b[1].x,y:b[0].y-b[1].y},{x:b[1].x-b[2].x,y:b[1].y-b[2].y},{x:b[2].x-b[3].x,y:b[2].y-b[3].y},{x:b[3].x-b[0].x,y:b[3].y-b[0].y}]},b.rectanglePerpendicularNormals=function(a){var c=this.rectangleSideVectors(a);return[b.leftNormalizedNormal(c[0]),b.leftNormalizedNormal(c[1])]},b.rotated=function(a){return void 0!==a.angle&&0!==a.angle},b.getBoundingBox=function(b){return b.boundingBox||a.Collider.RECTANGLE},b}();b.getAngle=function(a){return void 0===a.angle?0:a.angle},b.RADIANS_TO_DEGREES=.01745,a.Maths=b}(shuriken||(shuriken={}));var shuriken;!function(a){var b=function(){function a(a){var b=this;this._bindings=[],this.getWindow=function(a){return a.parentWindow||a.defaultView},a.addEventListener("mousemove",function(c){var d=b._getAbsoluteMousePosition(c),e=b.getElementPosition(a);b._mousePosition={x:d.x-e.x,y:d.y-e.y}},!1),a.addEventListener("mousemove",function(a){for(var c=0;c<b._bindings.length;c++)b._bindings[c](b.getMousePosition())},!1)}return a.prototype.bind=function(a){this._bindings.push(a)},a.prototype.unbind=function(a){for(var b=0;b<this._bindings.length;b++)if(this._bindings[b]===a)return void this._bindings.splice(b,1);throw"Function to unbind from mouse moves was never bound"},a.prototype.getMousePosition=function(){return this._mousePosition},a.prototype._getAbsoluteMousePosition=function(a){return a.pageX?{x:a.pageX,y:a.pageY}:a.clientX?{x:a.clientX,y:a.clientY}:void 0},a.prototype.getElementPosition=function(a){var b=a.getBoundingClientRect(),c=a.ownerDocument,d=c.body,e=this.getWindow(c);return{x:b.left+(e.pageXOffset||d.scrollLeft)-(d.clientLeft||0),y:b.top+(e.pageYOffset||d.scrollTop)-(d.clientTop||0)}},a}();a.MouseMoveListener=b}(shuriken||(shuriken={}));var shuriken;!function(a){var b=function(){function b(a,b,c,d,e,f){this._shuriken=a,this._game=b,c.style.outline="none",c.style.cursor="default",this._context=c.getContext("2d"),this._backgroundColor=f,c.width=d,c.height=e,this._viewSize={x:d,y:e},this._viewCenter={x:this.viewSize.x/2,y:this.viewSize.y/2}}return Object.defineProperty(b.prototype,"context",{get:function(){return this._context},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"viewSize",{get:function(){return this._viewSize},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"viewCenter",{get:function(){return this._viewCenter},set:function(a){this._viewCenter=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"background",{set:function(a){this._backgroundColor=a},enumerable:!0,configurable:!0}),b.prototype.update=function(b){var c=this.context,d=this.viewOffset(this._viewCenter,this._viewSize);c.translate(d.x,d.y);var e=[this._viewCenter.x-this._viewSize.x/2,this._viewCenter.y-this._viewSize.y/2,this._viewSize.x,this._viewSize.y];void 0!==this._backgroundColor?(c.fillStyle=this._backgroundColor,c.fillRect.apply(c,e)):c.clearRect.apply(c,e);for(var f=[this._game].concat(this._shuriken.entities.all().sort(this.zindexSort)),g=0,h=f.length;g<h;g++)if(void 0!==f[g].draw){var i=f[g];c.save(),void 0!==i.center&&void 0!==i.angle&&(c.translate(i.center.x,i.center.y),c.rotate(i.angle*a.Maths.RADIANS_TO_DEGREES),c.translate(-i.center.x,-i.center.y)),f[g].draw(c),c.restore()}c.translate(-d.x,-d.y)},b.prototype.onScreen=function(b){return a.Maths.rectanglesIntersecting(b,{size:this._viewSize,center:{x:this._viewCenter.x,y:this._viewCenter.y}})},b.prototype.viewOffset=function(a,b){return{x:-(a.x-b.x/2),y:-(a.y-b.y/2)}},b.prototype.zindexSort=function(a,b){return(a.zindex||0)<(b.zindex||0)?-1:1},b}();a.Renderer=b}(shuriken||(shuriken={}));var shuriken;!function(a){var b=function(){function a(a){this._runs=[],this._shuriken=a}return a.prototype.update=function(){this.run()},a.prototype.run=function(){for(;this._runs.length>0;){var a=this._runs.shift();a.fn(a.ojb)}},a.prototype.add=function(a,b){this._runs.push({obj:a,fn:b})},a}();a.Runner=b}(shuriken||(shuriken={}));var shuriken;!function(a){var c=function(){function a(a,b){this.stop=function(){this.nextTickFn=function(){}},this.setupRequestAnimationFrame(),this._gameLoop=b,this.start()}return a.prototype.start=function(){var a=this,b=Date.now(),c=function(){var c=Date.now(),d=c-b;b=c,a._gameLoop(d),window.requestAnimationFrame(a._nextTickFn)};this._nextTickFn=c,requestAnimationFrame(this._nextTickFn)},a.prototype.setupRequestAnimationFrame=function(){for(var b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"]},a}();a.Ticker=c}(shuriken||(shuriken={}));